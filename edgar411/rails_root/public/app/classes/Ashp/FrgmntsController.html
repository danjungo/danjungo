<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Ashp::FrgmntsController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Ashp::FrgmntsController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/app/controllers/ashp/frgmnts_controller_rb.html">
                app/controllers/ashp/frgmnts_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="../ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000058">before_create_save</a>&nbsp;&nbsp;
      <a href="#M000059">before_update_save</a>&nbsp;&nbsp;
      <a href="#M000060">do_save_logic</a>&nbsp;&nbsp;
      <a href="#M000062">get_my_hp_elem</a>&nbsp;&nbsp;
      <a href="#M000063">get_my_hp_enum</a>&nbsp;&nbsp;
      <a href="#M000061">get_my_html_from_open_uri</a>&nbsp;&nbsp;
      <a href="#M000068">glue_fragment_to_parent</a>&nbsp;&nbsp;
      <a href="#M000066">mygsub</a>&nbsp;&nbsp;
      <a href="#M000065">mysub</a>&nbsp;&nbsp;
      <a href="#M000069">peel_off_outer_tag</a>&nbsp;&nbsp;
      <a href="#M000067">regexp_enumerable</a>&nbsp;&nbsp;
      <a href="#M000057">rndr_frgmnt</a>&nbsp;&nbsp;
      <a href="#M000064">string_sandwich</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000058" class="method-detail">
        <a name="M000058"></a>

        <div class="method-heading">
          <a href="#M000058" class="method-signature">
          <span class="method-name">before_create_save</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Before I save a new creation, fill-in some data
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000058-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000058-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 33</span>
33:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_create_save</span>(<span class="ruby-identifier">record</span>)
34:     <span class="ruby-identifier">do_save_logic</span>(<span class="ruby-identifier">record</span>)
35:     <span class="ruby-identifier">record</span>.<span class="ruby-identifier">usr_id</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:usr_id</span>]
36:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000059" class="method-detail">
        <a name="M000059"></a>

        <div class="method-heading">
          <a href="#M000059" class="method-signature">
          <span class="method-name">before_update_save</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Before I save a new update, fill-in some data
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000059-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000059-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 39</span>
39:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">before_update_save</span>(<span class="ruby-identifier">record</span>)
40:     <span class="ruby-identifier">do_save_logic</span>(<span class="ruby-identifier">record</span>)
41:     <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">record</span>.<span class="ruby-identifier">usr_id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:usr_id</span>])
42:       <span class="ruby-comment cmt"># Force the call of a validation method.</span>
43:       <span class="ruby-identifier">record</span>.<span class="ruby-identifier">name</span> = <span class="ruby-value str">&quot;record_usr_id_ne_session_usr_id&quot;</span>
44:     <span class="ruby-keyword kw">end</span>
45:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000060" class="method-detail">
        <a name="M000060"></a>

        <div class="method-heading">
          <a href="#M000060" class="method-signature">
          <span class="method-name">do_save_logic</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Before any kind of save, do this. The logic here can be visualized as a 2D
grid. On x-Axis we have types of input used to build the fragment: Parent
Fragement, Input Report, Input URL. On y-Axis we have types of scrape
expressions used to scrape the input:
</p>
<pre>
    hpricot, hpricot-enumerable, string, gsub, sub, and regexp.
</pre>
<p>
This logic is implemented via nested case statements. The outer-case
handles type of input: parent, rpt, inputurl The inner-case handles type of
scrape expression.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000060-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000060-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 55</span>
 55:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">do_save_logic</span>(<span class="ruby-identifier">record</span>)
 56:     <span class="ruby-comment cmt"># After validation,</span>
 57:     <span class="ruby-comment cmt"># I either scrape a record.parent.frgtxt or a record.rpt.uurl or record.inputurl</span>
 58:     <span class="ruby-keyword kw">case</span>
 59:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">valid?</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
 60:       <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-value str">&quot;&lt;b&gt;The Data In This Fragment Is Invalid.&lt;/b&gt;&quot;</span>
 61: 
 62:     <span class="ruby-comment cmt"># 1st branch (the most common) is for when user specifies parent.frgtxt as input</span>
 63:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
 64:       <span class="ruby-comment cmt"># parent is shorthand for record.parent.frgtxt</span>
 65:       <span class="ruby-comment cmt"># parent is easy for end-user to remember</span>
 66:       <span class="ruby-identifier">parent</span> = <span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">frgtxt</span>
 67: 
 68:       <span class="ruby-comment cmt"># Now that I have the input, branch on the expression type</span>
 69:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">exprtype</span>.<span class="ruby-identifier">name</span>
 70: 
 71:       <span class="ruby-comment cmt"># peel-off-outer-tag returns parent with outer tag peeled off</span>
 72:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;peel-off-outer-tag&quot;</span>
 73:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">peel_off_outer_tag</span>(<span class="ruby-identifier">record</span>)
 74: 
 75:       <span class="ruby-comment cmt"># glue-fragment-to-parent allows user to glue any fragment to end of parent fragment</span>
 76:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;glue-fragment-to-parent&quot;</span>
 77:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">glue_fragment_to_parent</span>(<span class="ruby-identifier">record</span>)
 78: 
 79:       <span class="ruby-comment cmt"># string-sandwich allows user to sandwich parent between 2 strings</span>
 80:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;string-sandwich&quot;</span>
 81:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">string_sandwich</span>(<span class="ruby-identifier">record</span>)
 82: 
 83:       <span class="ruby-comment cmt"># sub allows user to do this: parent.sub(/change this/,'to this')</span>
 84:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;sub&quot;</span>
 85:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">mysub</span>(<span class="ruby-identifier">record</span>)
 86: 
 87:       <span class="ruby-comment cmt"># gsub allows user to do this: parent.gsub(/change this/,'to this')</span>
 88:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;gsub&quot;</span>
 89:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">mygsub</span>(<span class="ruby-identifier">record</span>)
 90: 
 91:       <span class="ruby-comment cmt"># This allows: parent =~ /regexp/</span>
 92:       <span class="ruby-comment cmt"># Then returns data from matching-array</span>
 93:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;regexp-enumerable&quot;</span>
 94:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">regexp_enumerable</span>(<span class="ruby-identifier">record</span>)
 95: 
 96:       <span class="ruby-comment cmt"># This branch works well on simple Hpricot scrape expressions like:</span>
 97:       <span class="ruby-comment cmt"># body or div#some-id or</span>
 98:       <span class="ruby-comment cmt"># table or a[@href*='yahoo.com'] or</span>
 99:       <span class="ruby-comment cmt"># span.some-class[text()*='Text I want to match']</span>
100:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;hpricot&quot;</span>
101:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-constant">Hpricot</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">frgtxt</span>).<span class="ruby-identifier">search</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>).<span class="ruby-identifier">to_html</span>
102: 
103:       <span class="ruby-comment cmt"># This branch might be the most useful.</span>
104:       <span class="ruby-comment cmt"># It displays a set of enumerable objects.</span>
105:       <span class="ruby-comment cmt"># Each is wrapped in a numbered-div-tag.</span>
106:       <span class="ruby-comment cmt"># I want the user to enter a scrapeexpr like this:</span>
107:       <span class="ruby-comment cmt"># table,[4,3] or</span>
108:       <span class="ruby-comment cmt"># body div&gt;table a,[0..999]</span>
109:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;hpricot-enumerable&quot;</span>
110:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">get_my_hp_enum</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">frgtxt</span>, <span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>)
111:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># case record.exprtype.name</span>
112: 
113: 
114:     <span class="ruby-comment cmt"># Branch here when user specifies EDGAR report as input</span>
115:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">rpt</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
116: 
117:       <span class="ruby-comment cmt"># Now that I have the input, branch on the expression type</span>
118:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">exprtype</span>.<span class="ruby-identifier">name</span>
119:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;hpricot&quot;</span>
120:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">get_my_hp_elem</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">rpt</span>.<span class="ruby-identifier">uurl</span>).<span class="ruby-identifier">search</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>).<span class="ruby-identifier">to_html</span>
121:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;hpricot-enumerable&quot;</span>
122:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">get_my_hp_enum</span>(<span class="ruby-identifier">get_my_html_from_open_uri</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">rpt</span>.<span class="ruby-identifier">uurl</span>), <span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>)
123:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># record.exprtype.name</span>
124: 
125:     <span class="ruby-comment cmt"># Branch here when user specifies arbitrary URL as input</span>
126:     <span class="ruby-comment cmt"># This is probably rare but is useful for testing purposes.</span>
127:     <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">inputurl</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
128: 
129:       <span class="ruby-comment cmt"># Now that I have the input, branch on the expression type</span>
130:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">exprtype</span>.<span class="ruby-identifier">name</span>
131:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;hpricot&quot;</span>
132:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">get_my_hp_elem</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">inputurl</span>).<span class="ruby-identifier">search</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>).<span class="ruby-identifier">to_html</span>
133:       <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;hpricot-enumerable&quot;</span>
134:         <span class="ruby-identifier">record</span>.<span class="ruby-identifier">frgtxt</span> = <span class="ruby-identifier">get_my_hp_enum</span>(<span class="ruby-identifier">get_my_html_from_open_uri</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">inputurl</span>), <span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>)
135:       <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># record.exprtype.name</span>
136: 
137:     <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># The outer-case handles type of input: parent, rpt, inputurl</span>
138: 
139:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000062" class="method-detail">
        <a name="M000062"></a>

        <div class="method-heading">
          <a href="#M000062" class="method-signature">
          <span class="method-name">get_my_hp_elem</span><span class="method-args">(u)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an Hpricot object from HTML obtained by <a
href="FrgmntsController.html#M000061">get_my_html_from_open_uri</a>()
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000062-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000062-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 156</span>
156:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_my_hp_elem</span>(<span class="ruby-identifier">u</span>)
157:     <span class="ruby-identifier">h0</span> = <span class="ruby-constant">Hpricot</span>(<span class="ruby-identifier">get_my_html_from_open_uri</span>(<span class="ruby-identifier">u</span>))
158:     <span class="ruby-comment cmt"># remove crap</span>
159:     <span class="ruby-comment cmt"># (h0/&quot;script&quot;).remove</span>
160:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">h0</span>
161:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000063" class="method-detail">
        <a name="M000063"></a>

        <div class="method-heading">
          <a href="#M000063" class="method-signature">
          <span class="method-name">get_my_hp_enum</span><span class="method-args">(h,scrapeexpr)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns Hpricot-enumerable from inputs: (HTML, Hpricot-Scrape-Expression)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000063-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000063-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 164</span>
164:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_my_hp_enum</span>(<span class="ruby-identifier">h</span>,<span class="ruby-identifier">scrapeexpr</span>)
165:     <span class="ruby-comment cmt"># Match something like this:  &quot;body div.gb2&gt;a[@href*='google.com'],[3,8]&quot;</span>
166:     <span class="ruby-identifier">rgxp</span> = <span class="ruby-regexp re">/(.*)?(\,)(\[)(\d+)(,)(\d+)(\])$/</span>
167:     <span class="ruby-comment cmt"># Parse scrapeexpr into 3 pieces.</span>
168:     <span class="ruby-comment cmt"># 1. Hpricot expression</span>
169:     <span class="ruby-comment cmt"># 2. Enumerable starting index</span>
170:     <span class="ruby-comment cmt"># 3. Enumerable size</span>
171:     <span class="ruby-identifier">ma</span> = <span class="ruby-identifier">rgxp</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">scrapeexpr</span>).<span class="ruby-identifier">to_a</span>
172:     <span class="ruby-identifier">hp_expr</span> = <span class="ruby-identifier">ma</span>[<span class="ruby-value">1</span>]
173:     <span class="ruby-identifier">e0</span> = <span class="ruby-identifier">ma</span>[<span class="ruby-value">4</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># starting index</span>
174:     <span class="ruby-identifier">esize</span> = <span class="ruby-identifier">ma</span>[<span class="ruby-value">6</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># size of the Enumerable object</span>
175: 
176:     <span class="ruby-comment cmt"># Debug Hpricot here.</span>
177:     <span class="ruby-identifier">en_expr</span> = <span class="ruby-node">&quot;[#{ma[4]},#{ma[6]}]&quot;</span>
178:     <span class="ruby-identifier">hp_str</span> = <span class="ruby-node">&quot;Hpricot(h).search(hp_expr)#{en_expr}&quot;</span>
179:     <span class="ruby-comment cmt"># eval() not available in production</span>
180:     <span class="ruby-comment cmt"># hp_enum = eval(hp_str)</span>
181:     <span class="ruby-comment cmt"># Debug Hpricot here.</span>
182: 
183:     <span class="ruby-comment cmt"># Now do it the hard way since I cant use eval()</span>
184:     <span class="ruby-identifier">hp_enum2</span> = []
185:     <span class="ruby-constant">Hpricot</span>(<span class="ruby-identifier">h</span>).<span class="ruby-identifier">search</span>(<span class="ruby-identifier">hp_expr</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
186:       <span class="ruby-comment cmt"># I count 2 indices as I fill hp_enum2</span>
187:       <span class="ruby-comment cmt"># e0 tells me when to start filling hp_enum2</span>
188:       <span class="ruby-comment cmt"># esize tells me when to stop filling hp_enum2</span>
189:       <span class="ruby-identifier">e0</span> = <span class="ruby-identifier">e0</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
190:       <span class="ruby-identifier">esize</span> = (<span class="ruby-identifier">esize</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">e0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>)
191:       <span class="ruby-identifier">hp_enum2</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">e</span> <span class="ruby-keyword kw">if</span> ((<span class="ruby-identifier">e0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">esize</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">-1</span>))
192:     <span class="ruby-keyword kw">end</span>
193: 
194:     <span class="ruby-comment cmt"># Now I have the data I want.</span>
195:     <span class="ruby-comment cmt"># I pretty it up by wrapping it in a div-tag-border and numbering each element in the enumerable object.</span>
196:     <span class="ruby-identifier">frgtxt</span> = <span class="ruby-value str">&quot;&quot;</span>
197:     <span class="ruby-identifier">d</span> = <span class="ruby-value">-1</span>
198:     <span class="ruby-identifier">hp_enum2</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">d</span> = <span class="ruby-identifier">d</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>); <span class="ruby-identifier">frgtxt</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;div class='hp-enum-divwrap'&gt;#{d.to_s}&lt;p /&gt;#{e.to_s}&lt;/div&gt;&quot;</span> }
199:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">frgtxt</span>
200:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000061" class="method-detail">
        <a name="M000061"></a>

        <div class="method-heading">
          <a href="#M000061" class="method-signature">
          <span class="method-name">get_my_html_from_open_uri</span><span class="method-args">(u)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns raw HTML. Usually it gets passed to <a
href="FrgmntsController.html#M000062">get_my_hp_elem</a>()
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000061-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000061-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 144</span>
144:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_my_html_from_open_uri</span>(<span class="ruby-identifier">u</span>)
145:     <span class="ruby-identifier">hdrs</span> = {<span class="ruby-value str">&quot;User-Agent&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X Mach-O; en-US; rv:1.8.1.1) Gecko/20061204 Firefox/2.0.0.1&quot;</span>, <span class="ruby-value str">&quot;Accept-Charset&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;utf-8&quot;</span>, <span class="ruby-value str">&quot;Connection&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;Keep-Alive&quot;</span>, <span class="ruby-value str">&quot;Accept&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;text/html&quot;</span>}
146:     <span class="ruby-identifier">my_html</span> = <span class="ruby-value str">&quot;&quot;</span>
147:     <span class="ruby-keyword kw">begin</span>
148:       <span class="ruby-identifier">open</span>(<span class="ruby-identifier">u</span>, <span class="ruby-identifier">hdrs</span>).<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">my_html</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">s</span>}
149:     <span class="ruby-keyword kw">rescue</span>
150:       <span class="ruby-identifier">my_html</span> = <span class="ruby-value str">&quot;&lt;html&gt;&lt;body&gt;&lt;p /&gt;&lt;b&gt;hello world&lt;/b&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span>
151:     <span class="ruby-keyword kw">end</span>
152:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">my_html</span>
153:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000068" class="method-detail">
        <a name="M000068"></a>

        <div class="method-heading">
          <a href="#M000068" class="method-signature">
          <span class="method-name">glue_fragment_to_parent</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Allows user to specify a fragment name and then glue the fragment text to
the end of the currently selected parent&#8216;s text.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000068-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000068-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 315</span>
315:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">glue_fragment_to_parent</span>(<span class="ruby-identifier">record</span>)
316:     <span class="ruby-comment cmt"># Assume the user passed in the fragment name via the scrape expression.</span>
317:     <span class="ruby-identifier">frgname</span> = <span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>
318:     <span class="ruby-comment cmt"># Get the text I want to apply glue to.</span>
319:     <span class="ruby-identifier">myfrg</span> = <span class="ruby-constant">Frgmnt</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">frgname</span>)
320:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">myfrg</span>
321:       <span class="ruby-identifier">myfrgtxt</span> = <span class="ruby-constant">Frgmnt</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">frgname</span>).<span class="ruby-identifier">frgtxt</span>
322:     <span class="ruby-keyword kw">else</span>
323:       <span class="ruby-identifier">myfrgtxt</span> = <span class="ruby-value str">&quot; &lt;hr /&gt;&lt;h1&gt;Invalid glue fragment name.  Try a different name. &lt;/h1&gt;&quot;</span>
324:     <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># if myfrg</span>
325:     <span class="ruby-comment cmt"># glue-em and return-em</span>
326:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">frgtxt</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">myfrgtxt</span>
327:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000066" class="method-detail">
        <a name="M000066"></a>

        <div class="method-heading">
          <a href="#M000066" class="method-signature">
          <span class="method-name">mygsub</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Wraps .gsub()
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000066-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000066-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 257</span>
257:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mygsub</span>(<span class="ruby-identifier">record</span>)
258:     <span class="ruby-comment cmt"># Assume the parent's fragment text was passed in.</span>
259:     <span class="ruby-identifier">parent</span> = (<span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">frgtxt</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>)
260:     <span class="ruby-comment cmt"># copy the scrape expression into a simple variable so I can study it.</span>
261:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>
262:     <span class="ruby-comment cmt"># Use a regexp to parse s</span>
263:     <span class="ruby-comment cmt"># Try to match something like this:</span>
264:     <span class="ruby-comment cmt"># s = 'gsub(/^matchme$/,&quot;then gimme this&quot;)'</span>
265:     <span class="ruby-identifier">rg</span> =  <span class="ruby-regexp re">/^gsub\(\/(.*?)\/,&quot;(.*?)&quot;\)$/</span>
266:     <span class="ruby-identifier">m</span> = <span class="ruby-identifier">rg</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">s</span>).<span class="ruby-identifier">to_a</span>
267:     <span class="ruby-comment cmt"># I should now have 2 tokens: regexp-token, replacement-text-token</span>
268:     <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;gsub format error.  Try again.&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">m</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">3</span>)
269:     <span class="ruby-comment cmt"># Build the gsub-regexp</span>
270:     <span class="ruby-identifier">srg</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>])
271:     <span class="ruby-comment cmt"># Note the replacement text</span>
272:     <span class="ruby-identifier">rt</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">2</span>]
273:     <span class="ruby-comment cmt"># run .gsub() against the parent's fragment text</span>
274:     <span class="ruby-identifier">newtext</span> = <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-identifier">srg</span>, <span class="ruby-identifier">rt</span>)
275:     <span class="ruby-comment cmt"># send it back</span>
276:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">newtext</span>
277:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000065" class="method-detail">
        <a name="M000065"></a>

        <div class="method-heading">
          <a href="#M000065" class="method-signature">
          <span class="method-name">mysub</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Wraps .sub()
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000065-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000065-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 234</span>
234:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">mysub</span>(<span class="ruby-identifier">record</span>)
235:     <span class="ruby-comment cmt"># Assume the parent's fragment text was passed in.</span>
236:     <span class="ruby-identifier">parent</span> = (<span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">frgtxt</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>)
237:     <span class="ruby-comment cmt"># copy the scrape expression into a simple variable so I can study it.</span>
238:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>
239:     <span class="ruby-comment cmt"># Use a regexp to parse s</span>
240:     <span class="ruby-comment cmt"># Try to match something like this:</span>
241:     <span class="ruby-comment cmt"># s = 'sub(/^matchme$/,&quot;then gimme this&quot;)'</span>
242:     <span class="ruby-identifier">rg</span> =  <span class="ruby-regexp re">/^sub\(\/(.*?)\/,&quot;(.*?)&quot;\)$/</span>
243:     <span class="ruby-identifier">m</span> = <span class="ruby-identifier">rg</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">s</span>).<span class="ruby-identifier">to_a</span>
244:     <span class="ruby-comment cmt"># I should now have 2 tokens: regexp-token, replacement-text-token</span>
245:     <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;sub format error.  Try again.&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">m</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">3</span>)
246:     <span class="ruby-comment cmt"># Build the sub-regexp</span>
247:     <span class="ruby-identifier">srg</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>])
248:     <span class="ruby-comment cmt"># Note the replacement text</span>
249:     <span class="ruby-identifier">rt</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">2</span>]
250:     <span class="ruby-comment cmt"># run .sub() against the parent's fragment text</span>
251:     <span class="ruby-identifier">newtext</span> = <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-identifier">srg</span>, <span class="ruby-identifier">rt</span>)
252:     <span class="ruby-comment cmt"># send it back</span>
253:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">newtext</span>
254:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000069" class="method-detail">
        <a name="M000069"></a>

        <div class="method-heading">
          <a href="#M000069" class="method-signature">
          <span class="method-name">peel_off_outer_tag</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns parent with the outer-tag peeled off
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000069-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000069-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 330</span>
330:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">peel_off_outer_tag</span>(<span class="ruby-identifier">record</span>)
331:     <span class="ruby-identifier">rg</span> = <span class="ruby-regexp re">/(&lt;\w+\s+.*?&gt;)(.*)(&lt;\/\w+&gt;)/</span>
332:     <span class="ruby-identifier">m_a</span> = <span class="ruby-identifier">rg</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">frgtxt</span>).<span class="ruby-identifier">to_a</span>
333:     <span class="ruby-comment cmt"># I want the meat in the middle of the sandwich.</span>
334:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">m_a</span>[<span class="ruby-value">2</span>]
335:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000067" class="method-detail">
        <a name="M000067"></a>

        <div class="method-heading">
          <a href="#M000067" class="method-signature">
          <span class="method-name">regexp_enumerable</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Wraps regexp and returns a div-wrapped match array
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000067-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000067-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 280</span>
280:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">regexp_enumerable</span>(<span class="ruby-identifier">record</span>)
281:     <span class="ruby-comment cmt"># Assume the parent's fragment text was passed in.</span>
282:     <span class="ruby-identifier">parent</span> = (<span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">frgtxt</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>)
283:     <span class="ruby-comment cmt"># copy the scrape expression into a simple variable so I can study it.</span>
284:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>
285:     <span class="ruby-comment cmt"># Use a regexp to parse s</span>
286:     <span class="ruby-comment cmt"># Try to match something like this:</span>
287:     <span class="ruby-comment cmt"># s = '/^matchme$/'</span>
288:     <span class="ruby-identifier">rg1</span> = <span class="ruby-regexp re">/^\/(.*?)\/$/</span>
289:     <span class="ruby-identifier">m</span> = <span class="ruby-identifier">rg1</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">s</span>).<span class="ruby-identifier">to_a</span>
290:     <span class="ruby-comment cmt"># I need to untangle the parsing-regexp from the user's regexp</span>
291:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
292:       <span class="ruby-identifier">usr_regexp_s</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>]
293:     <span class="ruby-keyword kw">else</span>
294:       <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'Format problem with your regexp.  Try something like this:  /^(abc)(123)$/'</span>
295:     <span class="ruby-keyword kw">end</span>
296: 
297:     <span class="ruby-comment cmt"># Now work with the user's regexp and parent fragment</span>
298:     <span class="ruby-identifier">usr_regexp</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>])
299:     <span class="ruby-identifier">usr_match</span> = <span class="ruby-identifier">usr_regexp</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">parent</span>).<span class="ruby-identifier">to_a</span>
300:     <span class="ruby-keyword kw">return</span> <span class="ruby-value str">&quot;Your Regular Expression Matches Nothing In The Parent Fragment&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">usr_match</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
301:     <span class="ruby-comment cmt"># I should now have a match but it's in an array.</span>
302:     <span class="ruby-comment cmt"># Give it back to the user in a form he can use.</span>
303:     <span class="ruby-comment cmt"># I guess a simple set of div-tags is friendly.</span>
304:     <span class="ruby-identifier">usr_match_s</span> = <span class="ruby-value str">&quot;&quot;</span>
305:     <span class="ruby-identifier">d</span> = <span class="ruby-value">-1</span>
306:     <span class="ruby-identifier">usr_match</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
307:       <span class="ruby-identifier">d</span> = <span class="ruby-identifier">d</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
308:       <span class="ruby-identifier">usr_match_s</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;div class='regexp-enum-divwrap'&gt;#{d.to_s}&lt;p /&gt;#{e}&lt;/div&gt;&quot;</span>
309:     <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt">#  usr_match.each</span>
310:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">usr_match_s</span>
311:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000057" class="method-detail">
        <a name="M000057"></a>

        <div class="method-heading">
          <a href="#M000057" class="method-signature">
          <span class="method-name">rndr_frgmnt</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000057-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000057-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 27</span>
27:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rndr_frgmnt</span>
28:     <span class="ruby-ivar">@myhpelem</span> = <span class="ruby-constant">Frgmnt</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]).<span class="ruby-identifier">frgtxt</span>
29:     <span class="ruby-identifier">render</span>(<span class="ruby-identifier">:layout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;layouts/html_tag_only&quot;</span>)
30:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000064" class="method-detail">
        <a name="M000064"></a>

        <div class="method-heading">
          <a href="#M000064" class="method-signature">
          <span class="method-name">string_sandwich</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Allows me to sandwich parent between 2 strings. parent is passed in via an
AR object named record by AS.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000064-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000064-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/ashp/frgmnts_controller.rb, line 204</span>
204:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">string_sandwich</span>(<span class="ruby-identifier">record</span>)
205: 
206:     <span class="ruby-comment cmt"># Assume the parent's fragment text was passed in.</span>
207:     <span class="ruby-identifier">parent</span> = (<span class="ruby-identifier">record</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">frgtxt</span> <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;&quot;</span>)
208: 
209:     <span class="ruby-comment cmt"># copy the scrape expression into a simple variable so I can study it.</span>
210:     <span class="ruby-identifier">s</span> = <span class="ruby-identifier">record</span>.<span class="ruby-identifier">scrapeexpr</span>
211:     <span class="ruby-comment cmt"># Use a regexp to parse s</span>
212:     <span class="ruby-comment cmt"># Try to match something like this:</span>
213:     <span class="ruby-comment cmt"># s = '&quot;hello&quot;+parent'</span>
214:     <span class="ruby-comment cmt"># or this:</span>
215:     <span class="ruby-comment cmt"># s = '&quot;hello&quot;+parent+&quot;bye&quot;'</span>
216:     <span class="ruby-identifier">rg2</span> = <span class="ruby-regexp re">/^(&quot;.*?&quot;)(\+)(parent)$/</span>
217:     <span class="ruby-identifier">rg3</span> = <span class="ruby-regexp re">/^(&quot;.*?&quot;)(\+)(parent)(\+)(&quot;.*&quot;)$/</span>
218:     <span class="ruby-comment cmt"># use .match() to parse tokens into array</span>
219:     <span class="ruby-identifier">m2</span> = <span class="ruby-identifier">rg2</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">s</span>).<span class="ruby-identifier">to_a</span>
220:     <span class="ruby-identifier">m3</span> = <span class="ruby-identifier">rg3</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">s</span>).<span class="ruby-identifier">to_a</span>
221:     <span class="ruby-keyword kw">case</span>
222:     <span class="ruby-keyword kw">when</span> (<span class="ruby-identifier">m2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">m3</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>)
223:       <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'Improperly formatted string sandwich.  I need something like this: &quot;&lt;hr /&gt;&quot;+parent+&quot;&lt;hr /&gt;&quot;'</span>
224:     <span class="ruby-keyword kw">when</span> (<span class="ruby-identifier">m2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>)
225:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">m2</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^\&quot;/</span>,<span class="ruby-value str">''</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/\&quot;$/</span>,<span class="ruby-value str">''</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">parent</span>
226:     <span class="ruby-keyword kw">when</span> (<span class="ruby-identifier">m3</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">6</span>)
227:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">m3</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^\&quot;/</span>,<span class="ruby-value str">''</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/\&quot;$/</span>,<span class="ruby-value str">''</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">parent</span> <span class="ruby-operator">+</span>  <span class="ruby-identifier">m3</span>[<span class="ruby-value">5</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/^\&quot;/</span>,<span class="ruby-value str">''</span>).<span class="ruby-identifier">sub</span>(<span class="ruby-regexp re">/\&quot;$/</span>,<span class="ruby-value str">''</span>)
228:     <span class="ruby-keyword kw">else</span>
229:       <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'Improperly formatted string sandwich.  I need something like this: &quot;&lt;hr /&gt;&quot;+parent+&quot;&lt;hr /&gt;&quot;'</span>
230:     <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># case</span>
231:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>